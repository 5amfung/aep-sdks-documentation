# Identity Event Reference

## Events Handled

### Identity Request Identity

This event is used for the Identity extension in one of the following situations:

- To retrieve the custom visitor identifiers
- To retrieve the Experience Cloud ID (MID)
- To append the visitor identifiers to an URL
- To synchronize a visitor identifier or a list of identifiers with the Adobe Experience Cloud ID Service

This event is generated by:

- Calling the Identity `getIdentifiers` API
- Calling the Identity `getExperienceCloudId` API
- Calling the Identity `appendVisitorInfoForURL` (Android) / `appendToUrl` (iOS) API
- Calling the Identity `syncIdentifier` or `syncIdentifiers` APIs

#### Event Details

| **Event Type**               | **Event Source**                      | **Paired** | **Paired Event**                                             |
| :--------------------------- | :------------------------------------ | :--------- | :----------------------------------------------------------- |
| com.adobe.eventType.identity | com.adobe.eventSource.requestIdentity | Yes        | [Identity Response Identity Event](#identity-response-identity) |

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key**             | **Value Type**      | **Optional** | **Description**                                              |
| :------------------ | :------------------ | :----------- | :----------------------------------------------------------- |
| baseurl             | String              | Yes          | The base URL passed as parameter to the `appendVisitorInfoForURL` (Android) / `appendToUrl` (iOS) API |
| visitoridentifiers  | Map<String, String> | Yes          | The visitor identifiers that need to be synced with the Experience Cloud ID Service. The keys of the map are the identifier types and the values are the associated identifiers |
| authenticationstate | Integer             | Yes          | The VisitorID Authentication State represent (Unknown - 0, Authenticated - 1, Logged Out - 2) |

#### Event Data Example

Append to URL request

```json
{
    "baseurl": "https://example.com/path?query=parameter1&other=parameter2"
}
```

#### Event Data Example

Sync identifiers request

```json
{
    "visitoridentifiers": {
        "idtype1" : "id1",
        "idtype2" : "id2"
    },
    "authenticationstate" : 1
}
```

#### Event Data Example

Experience Cloud ID request

There are no key-value pairs for this event.

#### Event Data Example

Identifiers request

There are no key-value pairs for this event.



### Generic Identity Request Content

This event is used to set identifiers in the Identity extension and it is generated by:

- Calling the MobileCore (Android) / ACPCore (iOS) `setAdvertisingIdentifier` API
- Calling the MobileCore (Android) / ACPCore (iOS)  `setPushIdentifier` API

#### Event Details

| **Event Type**                       | **Event Source**                      | **Paired** | **Paired Event** |
| :----------------------------------- | :------------------------------------ | :--------- | :--------------- |
| com.adobe.eventType.generic.identity | com.adobe.eventSource.requestIdentity | No         | N/A              |

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key**               | **Value Type** | **Optional** | **Description**                                              |
| :-------------------- | :------------- | :----------- | :----------------------------------------------------------- |
| advertisingidentifier | String         | Yes          | The value of the Advertising Identifier for the mobile device that needs to be set in the SDK. This key will be populated when `setAdvertisingIdentifier` API is called. |
| pushidentifier        | String         | Yes          | The value of the Push Identifier that needs to be set. This key will be populated when `setPushIdentifier` API is called |

#### Event Data Example

Set Advertising Identifier request

```json
{
    "advertisingidentifier": "advertisingIdExample"
}
```

#### Event Data Example

Set Push Identifier request

```json
{
    "pushidentifier": "pushIdExample"
}
```

## Events Dispatched

### Identity Response Identity

This event is a response from the Identity extension to the public API callbacks and it will be generated in response to an Identity Request Identity event when:

- Retrieving the Experience Cloud ID (MID) 
- Retrieving the custom visitor identifiers
- Synchronizing a visitor identifier or a list of identifiers with the Adobe Experience Cloud ID Service is complete
- The result for the append to URL request is ready

#### Event Details

| **Event Type**               | **Event Source**                       | **Paired** | **Paired Event**                                             |
| :--------------------------- | :------------------------------------- | :--------- | :----------------------------------------------------------- |
| com.adobe.eventType.identity | com.adobe.eventSource.responseIdentity | Yes        | [Identity Request Identity Event](#identity-request-identity) |

#### Data Payload Definition

Here are the key-value pairs in this event:

| **Key**               | **Value Type**            | **Optional** | **Description**                                              |
| :-------------------- | :------------------------ | :----------- | :----------------------------------------------------------- |
| mid                   | String                    | Yes          | The value of the Experience Cloud Identifier (MID)           |
| advertisingidentifier | String                    | Yes          | The value of the Advertising Identifier if it was previously set |
| pushidentifier        | String                    | Yes          | The SHA1 hashed Push Identifier if one was previously set    |
| blob                  | String                    | Yes          | The blob value retrieved from the Experience Cloud ID Service |
| locationhint          | String                    | Yes          | The location hint value retrieved from the Experience Cloud ID Service |
| visitoridslist        | List<Map<String, Object>> | Yes          | A list of visitor identifiers that were previously synced using `syncIdentifier` or `syncIdentifiers` public APIs. Each visitor id will have the following keys: `id_origin`, `id_type`, `id`, `authentication_state` |
| lastsync              | Long                      | Yes          | Timestamp in seconds of the last sync call sent to the Experience Cloud ID Service, by default it is 0 |
| updatedurl            | String                    | Yes          | The update URL when `appendVisitorInfoForURL` (Android) / `appendToUrl` (iOS) public API is called |

#### Event Data Example

When all identifiers, blob and location hint are populated

```json
{
    "mid": "midExample",
    "advertisingidentifier": "advertisingIdExample",
    "pushidentifier": "pushIdExample",
    "blob": "blobExample",
    "locationhint": "locationHintExample",
    "visitoridslist": [{
        "id_type": "type1",
        "id_origin": "origin1",
        "id": "id1",
        "authentication_state": 1
    },
    {
        "id_type": "type2",
        "id_origin": "origin2",
        "id": "id2",
        "authentication_state": 2
    }]
}
```

#### Event Data Example

The result for the appendToUrl request

```json
{
    "updatedurl": "https://example.com/path?query=parameter1&other=parameter2&adobe_mc=MCMID%3Dmidexample%7CMCAID%3Daidexample&adobe_aa_vid=visitoridexample"
}
```

### Configuration Content Request 

The Identity Extension dispatches a new Configuration Content Request event when a privacy change is detected in the response received from the Experience Cloud ID Service. This event will be handled by the Core extension and the new privacy status will be broadcasted to other extensions.

For more details about this event see the Mobile Core section.

### Analytics Content Request

The Identity Extension dispatches a new Analytics Content Request event when a push status preference change is detected, when the push identifier is initially set or when it is cleared from the SDK. This event will be handled by the Analytics extension and a new internal hit will be sent to the Adobe Analytics Server.

For more details about this event see [Analytics Content Request](../../adobe-analytics/analytics-event-reference.md#analytics-content-request)



## Shared State

**EXTENSION\_NAME**: `com.adobe.module.identity`

The Identity extension shared state is created in the following situations:

* When the extension first loads and is initialized
* When handling a sync request, regardless if the actual sync occurs. Occurs when setting the Push Identifier, Advertising Identifier, or customer's custom identifiers
* When the global privacy status changes to `optedout`, a shared state is set after the identifiers are cleared

| Key | Type | Description |
| :--- | :--- | :--- |
| mid | String | MID is a unique ID for that visitor for the given Experience Cloud organization ID |
| advertisingidentifier | String | iOS: the IDFA from retrieved Apple APIs<br />Android: The Advertising Identifier that is returned from Google Play Services |
| pushidentifier | String | The SHA1 hashed Push Identifier |
| blob | String | The blob value returned by the the Experience Cloud ID Service |
| locationhint | String | The Experience Cloud ID Service region ID. A region ID \(or location hint\), is a numeric identifier for the geographic location of a particular ID service data center |
| visitoridslist | List<Map<String, Object>> | The list of all the customer's custom identifiers |
| lastsync | Long | The timestamp of the last  sync with The Experience Cloud ID Service (in seconds), by default it is 0 |
